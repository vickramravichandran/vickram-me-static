
<!DOCTYPE html>
<!--[if IE]><![endif]-->
<!--[if lt IE 7 ]> <html lang="en" class="ie6"> <![endif]-->
<!--[if IE 7]> <html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="msvalidate.01" content="" />

    <title>Inject IPrincipal in ASP.NET Web API Controller | Vickram Ravichandran</title>

    
<link rel="shortcut icon" href="/static//favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="/static//favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/static//favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/static//favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/static//favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/static//favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/static//favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/static//favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static//favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static//favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static//favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static//favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/static//favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="192x192" href="/static//favicons/android-icon-192x192.png">
<link rel="manifest" href="/static//favicons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/static//favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,500,400italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>
    
    
    <link rel="canonical" href="http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller" />
    <meta name="keywords" content="asp.net, c#, webapi" />

    
<meta property="og:site_name" content="Vickram Ravichandran" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Inject IPrincipal in ASP.NET Web API Controller" />
<meta property="og:description" content="In ASP.NET MVC the current IPrincipal can be automatically made available to action methods by implementing the System.Web.Mvc.IModelBinder interface and returning the current authenticated user from HttpContext.User. We can accomplish the same in Web API using the HttpParameterBinding class. namespace App.Web.Http.Helpers { public" />
<meta property="og:url" content="http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller" />

    <meta property="article:tag" content="asp.net" />
    <meta property="article:tag" content="c#" />
    <meta property="article:tag" content="webapi" />

    
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Inject IPrincipal in ASP.NET Web API Controller" />
<meta name="twitter:description" content="In ASP.NET MVC the current IPrincipal can be automatically made available to action methods by implementing the System.Web.Mvc.IModelBinder interface and returning the current authenticated user from HttpContext.User. We can accomplish the same in Web API using the HttpParameterBinding class. namespace App.Web.Http.Helpers { public" />
<meta name="twitter:url" content="http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller" />
<meta name="twitter:label1" content="Written by" />
<meta name="twitter:data1" content="Vickram Ravichandran" />
<meta name="twitter:label2" content="Filed under" />
<meta name="twitter:data2" content="asp.net, c#, webapi" />


    
<script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Vickram Ravichandran",
        "logo": "https://vickram.blob.core.windows.net/images/vickram-ravichandran.png?sv=2017-04-17&ss=b&srt=o&sp=r&se=2050-10-15T01:20:16Z&st=2017-10-14T17:20:16Z&spr=https&sig=HW39593GSHaPDTL%2F1BqWDWOaNQczc5ZGnPLRzUswd8k%3D"
    },
    "author": {
        "@type": "Person",
        "name": "Vickram Ravichandran",
        "url": "http://www.vickram.me/author/vickramravichandran/",
        "sameAs": [ "https://www.linkedin.com/in/vickramravichandran" ]
    },
    "headline": "Inject IPrincipal in ASP.NET Web API Controller",
    "url": "http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller",
    "keywords": "asp.net, c#, webapi",
    "description": "In ASP.NET MVC the current IPrincipal can be automatically made available to action methods by implementing the System.Web.Mvc.IModelBinder interface and returning the current authenticated user from HttpContext.User. We can accomplish the same in Web API using the HttpParameterBinding class. namespace App.Web.Http.Helpers { public",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://www.vickram.me"
        }
    }
</script>





    
<script type="application/ld+json">
    {
        "@context": "http://schema.org/",
        "@type": "Person",
        "name": "Vickram Ravichandran",
        "image":"https://vickram.blob.core.windows.net/images/vickram-ravichandran.png?sv=2017-04-17&ss=b&srt=o&sp=r&se=2050-10-15T01:20:16Z&st=2017-10-14T17:20:16Z&spr=https&sig=HW39593GSHaPDTL%2F1BqWDWOaNQczc5ZGnPLRzUswd8k%3D",
        "jobTitle": "Senior Software Engineer",
        "url": "http://www.vickram.me",
        "sameAs" : [ https://www.linkedin.com/in/vickramravichandran, "http://www.vickramravichandran.com" ]
    }
</script>


    <link href="../app.css?v=mIPojOEcdz6Ph8_jbR0rTCs2IrCTDCJgDc6iGtpOEns1" rel="stylesheet"/>


    
    

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    


<div class="sidebar">

    <header class="header" role="banner">
        <a href="http://www.vickram.me">
            <img id="blog" class="logo" src="https://vickram.blob.core.windows.net/images/vickram-ravichandran.png?sv=2017-04-17&ss=b&srt=o&sp=r&se=2050-10-15T01:20:16Z&st=2017-10-14T17:20:16Z&spr=https&sig=HW39593GSHaPDTL%2F1BqWDWOaNQczc5ZGnPLRzUswd8k%3D">
        </a>
        
        <h1 class="title">
            <a href="http://www.vickram.me" style="text-decoration:none">Vickram Ravichandran</a>
        </h1>
        <p class="description"></p>

        <div class="separator"></div>
        
        <nav class="main-nav responsive">
            <ul>
                <li><a href="http://www.vickram.me">Home</a></li>
            </ul>
        </nav>

        <div class="social-icons">
            <a href="http://www.vickram.me" class="icon icon-home"></a>
            <a href="https://www.linkedin.com/in/vickramravichandran" class="icon icon-linkedin"></a>
            <a href="https://github.com/vickramravichandran" class="icon icon-github-circled"></a>
        </div>

    </header>

</div>


    <div class="content">
        <main role="main">
            

<link rel="amphtml" href="http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller/amp/" />



<article class="post tag-asp-net, tag-c, tag-webapi" role="article" itemscope itemtype="http://schema.org/Article">
    <h1 class="post-title">Inject IPrincipal in ASP.NET Web API Controller</h1>
    <span class="post-meta">
        
        by Vickram Ravichandran
    </span>
    <section class="post-content">
        <p>In ASP.NET MVC the current <code>IPrincipal</code> can be automatically made available to action methods by implementing the <code>System.Web.Mvc.IModelBinder</code> interface and returning the current authenticated user from <code>HttpContext.User</code>. We can accomplish the same in Web API using the <code>HttpParameterBinding</code> class.</p>
<pre><code class="language-csharp">namespace App.Web.Http.Helpers
{
    public class PrincipalParameterBinding : HttpParameterBinding
    {
        public PrincipalParameterBinding(HttpParameterDescriptor des)
            : base(des) { }

        public override Task ExecuteBindingAsync(
            ModelMetadataProvider metadataProvider,
            HttpActionContext actionContext, 
            CancellationToken cancellationToken)
        {
            SetValue(actionContext, Thread.CurrentPrincipal);

            return Task.FromResult&lt;object&gt;(null);
        }
    }
}
</code></pre>
<p>Add the rule to the <code>HttpConfiguration</code> during startup.</p>
<pre><code class="language-csharp">using App.Web.Http.Helpers;

namespace App.Web  
{
    public static class WebApiConfig
    {
        public static void Register(HttpConfiguration config)
        {
            // add the rule to the collection
            config.ParameterBindingRules
                  .Add(typeof(IPrincipal), 
                       des =&gt; new PrincipalParameterBinding(des));
        }
    }
}
</code></pre>
<p>Now a method like this will have its <code>IPrincipal</code> parameter automatically populated.</p>
<pre><code class="language-csharp">[RoutePrefix(&quot;api&quot;)]
public class MainController : ApiController  
{
    [Route(&quot;whoami&quot;)]
    public string GetPrincipal(IPrincipal user)
    {
        return user.Identity.Name;
    }
}
</code></pre>
<p>If we prefer not to add it globally, we will need a <code>[ParameterBinding]</code> attribute to decorate the method parameter.</p>
<pre><code class="language-csharp">namespace App.Web.Http.Helpers  
{
    public class IPrincipalParameterAttribute : ParameterBindingAttribute
    {
        public override HttpParameterBinding GetBinding(
            HttpParameterDescriptor desc)
        {
            if (desc.ParameterType == typeof(IPrincipal))
            {
                return new PrincipalParameterBinding(desc);
            }

            return parameter.BindAsError(&quot;Expected type IPrincipal&quot;);
        }
    }
}
</code></pre>
<p>Apply the <code>[IPrincipalParameter]</code> attribute to the method parameter.</p>
<pre><code class="language-csharp">public string GetPrincipal(
    [IPrincipalParameter]
    IPrincipal user) { ... }
</code></pre>

    </section>

    
<div class="post-meta">
    <div class="post-tags icon-tag">
            <a href="/tag/asp-net/">asp.net</a>  •             <a href="/tag/c/">c#</a>  •             <a href="/tag/webapi/">webapi</a>     </div>
</div>

    

<footer class="post-footer">
    <section class="share">
        <h4 class="post-share">Share this post</h4>
        <ul>
            <li>
                <a href="https://plus.google.com/share?url=http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller"
                    onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="icon icon-gplus"></i>
                </a>
            </li>
            <li>
                <a href="https://twitter.com/share?text=Inject+IPrincipal+in+ASP.NET+Web+API+Controller;url=http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="icon icon-twitter"></i>
                </a>
            </li>
            <li>
                <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="icon icon-facebook"></i>
                </a>
            </li>
        </ul>
    </section>
</footer>

    
<section class="post-comments">
    <div id="disqus_thread"></div>
    <script>
        /**
        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */

        var disqus_config = function () {
            this.page.url = "http://www.vickram.me/inject-iprincipal-in-asp-net-web-api-controller";
            this.page.identifier = "inject-iprincipal-in-asp-net-web-api-controller";
            this.page.title = "Inject IPrincipal in ASP.NET Web API Controller";
        };

        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//vickram.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</section>

</article>


        </main>
    </div>

    <script src="../app.js?v=_QvRy-x53dGG35wUxtaekHJdHwwEkHFwZztABa1JJJM1"></script>


</body>
</html>
